<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>File Filter and Paginated Table</title>
   <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>
<body>
   <div class="container">
       <!-- Sidebar with Filter Options and Pagination -->
       <div class="sidebar">
           <h1>Ascension Diagnostic Tool for Log Files</h1>
           <form method="POST" enctype="multipart/form-data">
               <label for="file">Choose a file (optional if already uploaded):</label>
               <input type="file" name="file" id="file" accept=".txt">

               <label>Choose filters:</label><br>

               <!-- Filters options as checkboxes -->
               <input type="checkbox" name="filter" value="all" id="filter-all"
               {% if 'all' in selected_filters %}checked{% endif %}>
               <label for="filter-all">All Lines</label><br>

               <input type="checkbox" name="filter" value="system" id="filter-system"
               {% if 'system' in selected_filters %}checked{% endif %}>
               <label for="filter-system">System Logs</label><br>

               <input type="checkbox" name="filter" value="data" id="filter-data"
               {% if 'data' in selected_filters %}checked{% endif %}>
               <label for="filter-data">Data Logs</label><br>

               <input type="checkbox" name="filter" value="debug" id="filter-debug"
               {% if 'debug' in selected_filters %}checked{% endif %}>
               <label for="filter-debug">Debug Logs</label><br>

               <input type="checkbox" name="filter" value="notification" id="filter-notification"
               {% if 'notification' in selected_filters %}checked{% endif %}>
               <label for="filter-notification">Notification Logs</label><br>

               <input type="checkbox" name="filter" value="warning" id="filter-warning"
               {% if 'warning' in selected_filters %}checked{% endif %}>
               <label for="filter-warning">Warning Logs</label><br>

               <input type="checkbox" name="filter" value="error" id="filter-error"
               {% if 'error' in selected_filters %}checked{% endif %}>
               <label for="filter-error">Error Logs</label><br>

               <input type="checkbox" name="filter" value="kernel" id="filter-kernel"
               {% if 'kernel' in selected_filters %}checked{% endif %}>
               <label for="filter-kernel">Kernel Logs</label><br>

               <input type="checkbox" name="filter" value="tx" id="filter-tx"
               {% if 'tx' in selected_filters %}checked{% endif %}>
               <label for="filter-tx">Tx Logs</label><br>

               <input type="checkbox" name="filter" value="rx" id="filter-rx"
               {% if 'rx' in selected_filters %}checked{% endif %}>
               <label for="filter-rx">Rx Logs</label><br>

               <!-- Date filter fields -->
               <label for="start_date">Start Date:</label>
               <input type="date" name="start_date" id="start_date" value="{{ start_date }}"><br>

               <label for="end_date">End Date:</label>
               <input type="date" name="end_date" id="end_date" value="{{ end_date }}"><br>

               <!-- Time shift input -->
               <label for="time_shift">Time Shift (hours):</label>
               <input type="number" name="time_shift" id="time_shift" step="1" value="0"><br>


               <button type="submit">Apply Filters</button>
           </form>

           <!-- Pagination controls in the sidebar -->
           <div class="pagination">
               {% if total_pages > 1 %}
                   {% if current_page > 1 %}
                       <a href="{{ url_for('show_table', page=current_page - 1, filter=selected_filters) }}" class="btn">Previous</a>
                   {% endif %}

                   {% set start_page = current_page - 4 if current_page > 5 else 1 %}
                   {% set end_page = current_page + 4 if current_page < total_pages - 5 else total_pages %}

                   {% if current_page > 5 %}
                       <a href="{{ url_for('show_table', page=1, filter=selected_filters) }}" class="btn">1</a>
                       <span>...</span>
                   {% endif %}

                   {% for p in range(start_page, end_page + 1) %}
                       <a href="{{ url_for('show_table', page=p, filter=selected_filters) }}" class="btn {% if p == current_page %}active{% endif %}">
                           {{ p }}
                       </a>
                   {% endfor %}

                   {% if current_page < total_pages - 5 %}
                       <span>...</span>
                       <a href="{{ url_for('show_table', page=total_pages, filter=selected_filters) }}" class="btn">{{ total_pages }}</a>
                   {% endif %}

                   {% if current_page < total_pages %}
                       <a href="{{ url_for('show_table', page=current_page + 1, filter=selected_filters) }}" class="btn">Next</a>
                   {% endif %}
               {% endif %}
           </div>
       </div>

       <!-- Content Area to Display Filtered Table -->
       <div class="content">
           <h2>Filtered Content (Paginated):</h2>
           <div class="output">
               {% if table %}
                   {{ table | safe }}
               {% else %}
                   <p>No data to display. Upload a file and apply filters to view the content.</p>
               {% endif %}
           </div>
       </div>
   </div>

   <script>
       // This script allows collapsing and expanding columns
       document.addEventListener('DOMContentLoaded', function() {
           const table = document.querySelector('table'); // Target the table
           const headers = table.querySelectorAll('th'); // Select all table headers

           headers.forEach((header, index) => {
               header.addEventListener('click', function() {
                   toggleColumn(index, header); // Toggle the column and pass the header
               });
           });

           function toggleColumn(index, header) {
               const rows = table.querySelectorAll('tr'); // Get all rows
               rows.forEach(row => {
                   const cells = row.querySelectorAll('th, td'); // Get both headers and data cells
                   if (cells[index]) {
                       // Toggle visibility only for data cells (td), not headers (th)
                       if (row !== table.querySelector('tr')) { 
                           cells[index].classList.toggle('hidden-column');
                       }
                   }
               });

               // Toggle collapsed state for the header itself
               header.classList.toggle('collapsed-header');
           }
       });
   </script>
</body>
</html>
